-- ==========================================
--    HARDCORE TEXT SCANNER (50 STUDS)
--    Scans Everything: GUIs, Models, Humanoids, Prompts
-- ==========================================

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer

if CoreGui:FindFirstChild("HardcoreTextScannerUI") then
    CoreGui.HardcoreTextScannerUI:Destroy()
end

-- ==========================================
--              UI CREATION
-- ==========================================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "HardcoreTextScannerUI"
ScreenGui.Parent = CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -250, 0.5, -200)
MainFrame.Size = UDim2.new(0, 500, 0, 400)
MainFrame.ClipsDescendants = true

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

local Topbar = Instance.new("Frame")
Topbar.Name = "Topbar"
Topbar.Parent = MainFrame
Topbar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Topbar.Size = UDim2.new(1, 0, 0, 35)
Topbar.BorderSizePixel = 0

local Title = Instance.new("TextLabel")
Title.Parent = Topbar
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 15, 0, 0)
Title.Size = UDim2.new(0.8, 0, 1, 0)
Title.Font = Enum.Font.GothamBold
Title.Text = "ðŸ”¥ Hardcore Text Scanner (50 Studs)"
Title.TextColor3 = Color3.fromRGB(255, 100, 0)
Title.TextSize = 15
Title.TextXAlignment = Enum.TextXAlignment.Left

local CloseBtn = Instance.new("TextButton")
CloseBtn.Parent = Topbar
CloseBtn.BackgroundTransparency = 1
CloseBtn.Position = UDim2.new(1, -35, 0, 0)
CloseBtn.Size = UDim2.new(0, 35, 1, 0)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Text = "X"
CloseBtn.TextColor3 = Color3.fromRGB(255, 60, 60)
CloseBtn.TextSize = 16

local ScanBtn = Instance.new("TextButton")
ScanBtn.Parent = MainFrame
ScanBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
ScanBtn.Position = UDim2.new(0, 10, 0, 45)
ScanBtn.Size = UDim2.new(1, -20, 0, 35)
ScanBtn.Font = Enum.Font.GothamBold
ScanBtn.Text = "FORCE SCAN EVERYTHING"
ScanBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ScanBtn.TextSize = 14
local ScanCorner = Instance.new("UICorner")
ScanCorner.CornerRadius = UDim.new(0, 5)
ScanCorner.Parent = ScanBtn

local ScrollList = Instance.new("ScrollingFrame")
ScrollList.Parent = MainFrame
ScrollList.Active = true
ScrollList.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
ScrollList.BorderSizePixel = 0
ScrollList.Position = UDim2.new(0, 10, 0, 90)
ScrollList.Size = UDim2.new(1, -20, 1, -100)
ScrollList.ScrollBarThickness = 5
ScrollList.CanvasSize = UDim2.new(0, 0, 0, 0)

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Parent = ScrollList
UIListLayout.Padding = UDim.new(0, 8)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- ==========================================
--              FUNCTIONS
-- ==========================================

local dragging, dragInput, dragStart, startPos
Topbar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)
game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)
game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)
Topbar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

CloseBtn.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

local function Get3DPosition(obj)
    if not obj then return nil end
    if obj:IsA("BasePart") then return obj.Position end
    if obj:IsA("Model") and obj.PrimaryPart then return obj.PrimaryPart.Position end
    if obj:IsA("Attachment") then return obj.WorldPosition end
    
    local parent = obj.Parent
    while parent and parent ~= game do
        if parent:IsA("BasePart") then return parent.Position end
        if parent:IsA("Model") and parent.PrimaryPart then return parent.PrimaryPart.Position end
        parent = parent.Parent
    end
    return nil
end

local function GetPath(instance)
    if not instance then return "Unknown Path" end
    local path = instance.Name
    local current = instance.Parent
    while current and current ~= game do
        path = current.Name .. "." .. path
        current = current.Parent
    end
    return path
end

-- ==========================================
--              SCAN LOGIC
-- ==========================================
ScanBtn.MouseButton1Click:Connect(function()
    for _, child in ipairs(ScrollList:GetChildren()) do
        if child:IsA("Frame") then child:Destroy() end
    end

    local character = LocalPlayer.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end
    local hrpPos = character.HumanoidRootPart.Position

    local count = 0
    local foundTexts = {} -- Prevent duplicates

    local searchAreas = {Workspace}
    if LocalPlayer:FindFirstChild("PlayerGui") then table.insert(searchAreas, LocalPlayer.PlayerGui) end
    pcall(function() table.insert(searchAreas, CoreGui) end)

    local function CreateRow(text, path, pos3D)
        if foundTexts[text] then return end -- Skip duplicate texts
        foundTexts[text] = true
        count = count + 1

        local RowFrame = Instance.new("Frame")
        RowFrame.Parent = ScrollList
        RowFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        RowFrame.Size = UDim2.new(1, 0, 0, 60)
        local RowCorner = Instance.new("UICorner")
        RowCorner.CornerRadius = UDim.new(0, 5)
        RowCorner.Parent = RowFrame
        
        local TextDisplay = Instance.new("TextLabel")
        TextDisplay.Parent = RowFrame
        TextDisplay.BackgroundTransparency = 1
        TextDisplay.Position = UDim2.new(0, 10, 0, 5)
        TextDisplay.Size = UDim2.new(1, -70, 0, 20)
        TextDisplay.Font = Enum.Font.GothamBold
        TextDisplay.Text = "Text: " .. tostring(text)
        TextDisplay.TextColor3 = Color3.fromRGB(255, 255, 255)
        TextDisplay.TextSize = 14
        TextDisplay.TextXAlignment = Enum.TextXAlignment.Left
        TextDisplay.TextTruncate = Enum.TextTruncate.AtEnd
        
        local PathDisplay = Instance.new("TextLabel")
        PathDisplay.Parent = RowFrame
        PathDisplay.BackgroundTransparency = 1
        PathDisplay.Position = UDim2.new(0, 10, 0, 30)
        PathDisplay.Size = UDim2.new(1, -70, 0, 20)
        PathDisplay.Font = Enum.Font.Gotham
        PathDisplay.Text = "Loc: " .. (path or "No Path/File Found")
        PathDisplay.TextColor3 = Color3.fromRGB(150, 150, 150)
        PathDisplay.TextSize = 11
        PathDisplay.TextXAlignment = Enum.TextXAlignment.Left
        PathDisplay.TextTruncate = Enum.TextTruncate.AtEnd

        local TpBtn = Instance.new("TextButton")
        TpBtn.Parent = RowFrame
        TpBtn.Position = UDim2.new(1, -60, 0, 15)
        TpBtn.Size = UDim2.new(0, 50, 0, 30)
        TpBtn.Font = Enum.Font.GothamBold
        TpBtn.Text = pos3D and "TP" or "NO TP"
        TpBtn.BackgroundColor3 = pos3D and Color3.fromRGB(40, 180, 90) or Color3.fromRGB(100, 100, 100)
        TpBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        TpBtn.TextSize = 12
        local TpCorner = Instance.new("UICorner")
        TpCorner.CornerRadius = UDim.new(0, 5)
        TpCorner.Parent = TpBtn

        if pos3D then
            TpBtn.MouseButton1Click:Connect(function()
                local char = LocalPlayer.Character
                if char and char:FindFirstChild("HumanoidRootPart") then
                    char.HumanoidRootPart.CFrame = CFrame.new(pos3D + Vector3.new(0, 3, 0))
                end
            end)
        end
    end

    -- FORCE SCAN EVERYTHING
    for _, area in ipairs(searchAreas) do
        for _, obj in ipairs(area:GetDescendants()) do
            local textStr = nil
            local pos3D = Get3DPosition(obj)
            
            -- Filter distance if we have a 3D position
            if pos3D then
                local distance = (hrpPos - pos3D).Magnitude
                if distance > 50 then continue end
            end

            -- 1. Normal Text UI
            if obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("TextBox") then
                textStr = obj.Text
            
            -- 2. Humanoid Names (Avatars floating text)
            elseif obj:IsA("Humanoid") then
                textStr = obj.DisplayName ~= "" and obj.DisplayName or obj.Parent.Name
                
            -- 3. Models (Some bases use Model Names as text)
            elseif obj:IsA("Model") and obj.Name ~= "Workspace" and obj.Name ~= "Part" then
                -- Check if name has alphabets (not just numbers/default names)
                if obj.Name:match("%a+") then
                    textStr = obj.Name
                end

            -- 4. Prompts & Dialogs
            elseif obj:IsA("ProximityPrompt") then
                textStr = obj.ActionText .. " " .. obj.ObjectText
            elseif obj:IsA("Dialog") then
                textStr = obj.InitialPrompt
            end
            
            -- Clean empty text
            if textStr and type(textStr) == "string" and textStr:gsub("%s+", "") ~= "" then
                CreateRow(textStr, GetPath(obj), pos3D)
            end
        end
    end
    
    ScrollList.CanvasSize = UDim2.new(0, 0, 0, count * 68)
    
    if count == 0 then
        ScanBtn.Text = "NOTHING FOUND (SCAN AGAIN)"
        task.delay(2, function() ScanBtn.Text = "FORCE SCAN EVERYTHING" end)
    else
        ScanBtn.Text = "FOUND " .. count .. " TEXTS/MODELS! (SCAN AGAIN)"
    end
end)
